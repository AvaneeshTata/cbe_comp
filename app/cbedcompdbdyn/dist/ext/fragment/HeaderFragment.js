sap.ui.define(["sap/m/MessageToast","sap/ui/export/Spreadsheet","sap/ui/model/json/JSONModel","sap/ui/export/library"],function(e,t,g,s){"use strict";var n=s.EdmType;return{onRowExpand:function(e){debugger;if(e.getSource().getText()=="ItemList-ExpandAll"){debugger;e.getSource().setText("ItemList-CollapseAll");let t=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--icon2");if(t.getSrc()=="sap-icon://navigation-right-arrow"){t.firePress()}let g=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--icon3");if(g.getSrc()=="sap-icon://navigation-right-arrow"){g.firePress()}}else{e.getSource().setText("ItemList-ExpandAll");let t=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--icon2");if(t.getSrc()=="sap-icon://navigation-up-arrow"){t.firePress()}let g=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--icon3");if(g.getSrc()=="sap-icon://navigation-down-arrow"){g.firePress()}}},onColumnExpand:function(e){var t=e.getSource().getParent().getParent().getParent().getParent().getParent().getSections()[0].getSubSections()[0].mAggregations._grid.mAggregations.content[0].mAggregations.content.mAggregations.items[1].mAggregations.content[0].mAggregations.items;var g=e.getSource().getParent().getParent().getParent().getParent().getParent().getSections()[0].mAggregations._grid.mAggregations.content[0].mAggregations._grid.mAggregations.content[0].mAggregations.content.mAggregations.items[0].mAggregations.items[1].mAggregations.items[0].mAggregations.items[1];if(e.getSource().getPressed()==true){e.getSource().setText("VendorList-CollapseAll");if(g.getSrc()=="sap-icon://expand"){g.firePress()}for(let e=0;e<t.length;e++){let g=t[0].getItems()[1].getItems().length;debugger;var s=t[e].getItems()[1].getItems()[g-1].mAggregations.items[1].mAggregations.items[1].mAggregations.columns[1].mAggregations.header.mAggregations.items[1];if(s.getSrc()=="sap-icon://expand"){s.firePress()}}}else{e.getSource().setText("VendorList-ExpandAll");if(g.getSrc()=="sap-icon://collapse"){g.firePress()}for(let e=0;e<t.length;e++){let g=t[0].getItems()[1].getItems().length;var s=t[e].getItems()[1].getItems()[g-1].mAggregations.items[1].mAggregations.items[1].mAggregations.columns[1].mAggregations.header.mAggregations.items[1];if(s.getSrc()=="sap-icon://collapse"){s.firePress()}}}},onExportExcel:async function(t){debugger;var g=[];let s=t.getSource().getModel().bindContext("/getVendorDetails(...)");await s.execute();let o=s.getBoundContext();let r=o.getObject();let l=JSON.parse(r.value);let a=0;var i=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--mainhbox1");let m=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--projectvalue").getText();let c=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--itemstable1");let u=[];debugger;for(let e=0;e<c.getItems().length;e++){u.push({})}var g=[{2:"Commercial Bid Evaluation"},{1:"",11:"Supplier"},{1:"",11:"Location"},{1:"Project",2:`${"Project: "+m}`,11:"Qtn. Ref."},{1:"",11:"Date"},{1:"",11:"Validity"},{1:""}];let p={};let d=2;for(let e=0;e<c.getColumns().length;e++){if(c.getColumns()[e].getVisible()==true){p[d]=c.getColumns()[e].getHeader().getText();d++}}g.push(p);g[1][d]=g[1][11];delete g[1][11];g[2][d]=g[2][11];delete g[2][11];g[3][d]=g[3][11];delete g[3][11];g[4][d]=g[4][11];delete g[4][11];g[5][d]=g[5][11];delete g[5][11];debugger;for(let e=0;e<c.getItems().length;e++){let t={};let s=2;for(let g=0;g<c.getColumns().length;g++){if(c.getColumns()[g].getVisible()==true){t[s]=c.getItems()[e].getCells()[g].getText();s++}}g.push(t)}var I=[{1:"",2:""},{1:"3",[d]:"Spares for 2 Years operation"},{1:" ",[d]:"Grand Total"},{1:"4",[d]:"Freight"},{1:"5",[d]:"Inspection / Testing Charges"},{1:"B.3",[d]:"Documentation Charges"},{1:"C",[d]:"RNOD"},{1:"D.1",[d]:"Custom Duty & Cess"},{1:"D.2",[d]:"Tax"},{1:"D.6",[d]:"Shipment charges from EXW to ISRO Mahendragiri"},{1:"D",[d]:"Total Basic Price including packing, marking & forwarding, Transportation including Taxes"},{[d]:"Total Basic Price including packing, marking & forwarding, Transportation excluding Taxes"},{1:"F",[d]:"Per Diem rate for Supervision for Erection and commissioning"},{1:"G.3",[d]:"Scope and Responsibilities"},{1:"G.4",[d]:"Commercial Terms"},{1:"G.5",[d]:"Compliance Terms"},{1:"G.6",[d]:"Others"},{1:"G.9",[d]:"Contact person"},{1:"G.10",[d]:"Contact No"},{1:"G.11",[d]:"Order can be given to .."},{1:"G.12",[d]:"Technical approved"},{1:"G.13",[d]:"Approved vendor"}];debugger;var f=g.concat(I);var x=[];var b=i.getItems()[1].getContent()[0].getItems();let h=[];let C=[];let T=d+2;for(let e=0;e<b.length;e++){let t=b[e].getItems()[0].getItems()[0].getTooltip();let g=b[e].getItems()[0].getItems()[1].getText();let s=b[e].getItems()[1].getItems();let n=[];h=[{[T]:""},{[T]:t},{[T]:g}];let o=[];let r=b[e].getItems()[2].getItems()[1].getItems();for(let e=0;e<s.length;e++){let t=s[e].getItems()[0].getItems()[0].getText();let g=s[e].getItems()[0].getItems()[1].getText();let n=s[e].getItems()[0].getItems()[2].getText();let i=s[e].getItems()[1].getItems()[0].getText();let m=T;let c=T+1;let p=T+2;T=T+3;let d=[{[m]:t},{[m]:g},{[m]:n},{[m]:i},{[m]:"Unit Rate",[c]:"Quantity",[p]:"Total Amount"}];var S=[];debugger;for(let t=0;t<u.length;t++){var P=s[e].getItems()[1].getItems()[1].getItems()[t].getCells()[2];if(P.getMetadata()._sClassName=="sap.m.Text"){S.push({[m]:s[e].getItems()[1].getItems()[1].getItems()[t].getCells()[0].getText(),[c]:s[e].getItems()[1].getItems()[1].getItems()[t].getCells()[1].getText(),[p]:s[e].getItems()[1].getItems()[1].getItems()[t].getCells()[2].getText()})}else{debugger;var A=l[a];var v=s[e].getItems()[1].getItems()[1].getItems()[t].getCells()[2].getItems()[0].getText();for(let e=0;e<A.length;e++){v=v+`(Unit Rate : ${A[e].unit_rate}, Quantity : ${A[e].quantity}, Total Amount: ${A[e].total})\n`}S.push({[m]:s[e].getItems()[1].getItems()[1].getItems()[t].getCells()[0].getText(),[c]:s[e].getItems()[1].getItems()[1].getItems()[t].getCells()[1].getText(),[p]:v});a++}}d=d.concat(S);let I=s[e].getItems()[1].getItems()[1].getItems();let f=u.length;let x=[{[m]:""},{[p]:I[f+1].getCells()[2].getText()},{[p]:I[f+2].getCells()[2].getText()},{[m]:I[f+3].getCells()[0].getText(),[p]:I[f+3].getCells()[2].getText()},{[m]:I[f+4].getCells()[0].getText(),[p]:I[f+4].getCells()[2].getText()},{[m]:I[f+5].getCells()[0].getText(),[p]:I[f+5].getCells()[2].getText()},{[p]:I[f+6].getCells()[1].getText()},{[p]:I[f+7].getCells()[1].getText()},{[m]:I[f+8].getContent()[0].getText()},{[m]:I[f+9].getCells()[0].getText()},{[p]:I[f+10].getCells()[2].getText()},{[p]:I[f+11].getCells()[2].getText()},{[p]:I[f+12].getCells()[2].getText()},{[m]:r[e].getItems()[0].getContent()[0].getText()},{[m]:r[e].getItems()[1].getContent()[0].getText()},{[m]:r[e].getItems()[2].getContent()[0].getText()},{[m]:r[e].getItems()[3].getContent()[0].getText()},{[m]:r[e].getItems()[4].getText()},{[m]:r[e].getItems()[5].getText()},{[m]:r[e].getItems()[6].getText()},{[m]:r[e].getItems()[7].getText()},{[m]:r[e].getItems()[8].getText()}];d=d.concat(x);o.push(d)}const i=o.map(e=>e.length);const m=i.every((e,t,g)=>e===g[0]);let c=[];if(m){for(let e=0;e<o[0].length;e++){let t={};for(let g=0;g<o.length;g++){Object.assign(t,o[g][e])}c.push(t)}console.log(c)}else{console.log("Arrays in updatarr have different lengths. Unable to merge.")}h=h.concat(c);C.push(h)}let y=[];const j=C.map(e=>e.length);const D=j.every((e,t,g)=>e===g[0]);if(D){for(let e=0;e<C[0].length;e++){let t={};for(let g=0;g<C.length;g++){Object.assign(t,C[g][e])}y.push(t)}console.log(y)}else{console.log("Arrays in updatarr have different lengths. Unable to merge.")}console.log(y);let O=[];if(f.length===y.length){for(let e=0;e<f.length;e++){let t=Object.assign({},f[e],y[e]);O.push(t)}console.log(O)}else{console.log("Arrays have different lengths. Unable to merge.")}let w=[];for(let e=1;e<T;e++){if(T==1){w.push({label:` `,property:`${e+1}`,type:n.String,width:"100"})}else{w.push({label:` `,property:`${e+1}`,type:n.String})}}debugger;debugger;var E=new sap.ui.export.Spreadsheet({workbook:{columns:w,context:{application:"SAP UI5 Export Sample",author:"Sample"},hierarchyLevel:"level"},dataSource:O,fileName:"cbe_comp.xlsx"});E.build().then(function(){e.show("Exported successfully!")}).catch(function(t){e.show("Export failed: "+t)})}}});