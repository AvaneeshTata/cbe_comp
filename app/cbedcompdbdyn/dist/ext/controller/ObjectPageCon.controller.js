sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/m/MessageToast"],function(e,t){"use strict";return e.extend("cbedcompdbdyn.ext.controller.ObjectPageCon",{override:{onInit:function(){var e=this.base.getExtensionAPI().getModel()},routing:{onAfterBinding:async function(e){try{debugger;function se(){var e=Math.floor(Math.random()*1e6);var t=(new Date).getTime();var a=t+"-"+e;return a}var a=e.sPath;var s=a.match(/'([^']+)'/);sap.ui.core.BusyIndicator.show();var n=this.base.getAppComponent().getManifestObject()._oBaseUri._string;if(n){var o={url:n+"odata/v4/catalogcbeservice/Project_Details?$filter=ProjectId eq "+`'${s[1]}'`,method:"GET"}}else{var o={url:"/odata/v4/catalogcbeservice/Project_Details?$filter=ProjectId eq "+`'${s[1]}'`,method:"GET"}}var l;await $.ajax(o).done(async(e,t,a)=>{l=e.value}).fail(e=>{console.log(e);t.show(e)});if(n){var o={url:n+"odata/v4/catalogcbeservice/Item_details?$filter=ProjectId eq "+`'${s[1]}'`,method:"GET"}}else{var o={url:"/odata/v4/catalogcbeservice/Item_details?$filter=ProjectId eq "+`'${s[1]}'`,method:"GET"}}var d;await $.ajax(o).done(async(e,t,a)=>{d=e.value}).fail(e=>{console.log(e);t.show(e)});if(n){var o={url:n+"odata/v4/catalogcbeservice/Vendor_details?$filter=ProjectId eq "+`'${s[1]}'`,method:"GET"}}else{var o={url:"/odata/v4/catalogcbeservice/Vendor_details?$filter=ProjectId eq "+`'${s[1]}'`,method:"GET"}}var r;await $.ajax(o).done(async(e,t,a)=>{r=e.value}).fail(e=>{console.log(e)});if(n){var o={url:n+"odata/v4/catalogcbeservice/PAN_Info",method:"GET"}}else{var o={url:"/odata/v4/catalogcbeservice/PAN_Info",method:"GET"}}var m;await $.ajax(o).done(async(e,t,a)=>{m=e.value}).fail(e=>{console.log(e)});if(n){var o={url:n+"odata/v4/catalogcbeservice/PAN_vendor_reponse_details",method:"GET"}}else{var o={url:"/odata/v4/catalogcbeservice/PAN_vendor_reponse_details",method:"GET"}}var i;await $.ajax(o).done(async(e,t,a)=>{i=e.value}).fail(e=>{console.log(e)});var c=this.getView().getContent()[0].getSections()[0].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent();debugger;let ne=c.getItems()[0].getItems()[2].getItems()[0].getColumns();for(let ie=0;ie<ne.length;ie++){ne[ie].setStyleClass("custcolorclass")}c.getItems()[0].getItems()[0].getItems()[0].getItems()[0].getItems()[0].setVisible(false);c.getItems()[0].getItems()[0].getItems()[0].getItems()[1].getItems()[1].setText(`${" "+l[0]?.Project_Description??" "}`);c.getItems()[0].getItems()[0].getItems()[0].getItems()[1].getItems()[1].setTextAlign("End");c.getItems()[0].getItems()[0].getItems()[0].getItems()[2].getItems()[0].setVisible(false);var g=c.getItems()[0].getItems()[2].getItems()[0];var p=c.getItems()[0].getItems()[1].getItems()[0];if(!p.getItems()[1]){p.addItem(new sap.ui.core.Icon(`${"cylindricaldtaicon"+se()}`,{src:"sap-icon://expand",color:"darkblue",hoverColor:"red",activeColor:"darkgreen",size:"12px",width:"20px",press:function(e){debugger;var t=c.getItems()[0];let a=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--total_basic_pricing");let s;let n=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--newItemID1");let o;if(t.getWidth()=="30%"){g.setFixedLayout(false);t.setWidth("80%");e.getSource().setSrc("sap-icon://collapse")}else{g.setFixedLayout(true);t.setWidth("30%");e.getSource().setSrc("sap-icon://expand")}}}))}g.destroyItems();const oe=new Set;const le=[];d.forEach(e=>{if(!oe.has(e.Item_Code)){oe.add(e.Item_Code);le.push(e)}});for(let ce=0;ce<le.length;ce++){g.addItem(new sap.m.ColumnListItem(`${"collistitem"+(ce+1)}`));let ge=g.getItems()[ce];let pe=new sap.m.Text(`${"itemdesc"+(ce+1)}`,{text:`${d[ce]?.Item_Short_Description??" "}`,tooltip:`${d[ce]?.Item_Short_Description??" "}`,wrapping:false});ge.addCell(pe);let xe=new sap.m.Text(`${"tag_no"+(ce+1)}`,{text:`${d[ce]?.tag_no??" "}`,tooltip:`${d[ce]?.tag_no??" "}`,wrapping:false});ge.addCell(xe);let ue=new sap.m.Text(`${"types_of_vessel"+(ce+1)}`,{text:`${d[ce]?.types_of_vessel??" "}`,tooltip:`${d[ce]?.types_of_vessel??" "}`,wrapping:false});ge.addCell(ue);let Ie=new sap.m.Text(`${"capacity_each_in_cu_mtr"+(ce+1)}`,{text:`${d[ce]?.capactity_each??" "}`,tooltip:`${d[ce]?.capactity_each??" "}`,wrapping:false});ge.addCell(Ie);let we=new sap.m.Text(`${"dia_in_mm"+(ce+1)}`,{text:`${d[ce]?.dia??" "}`,tooltip:`${d[ce]?.dia??" "}`,wrapping:false});ge.addCell(we);let $e=new sap.m.Text(`${"tl_to_tl_len"+(ce+1)}`,{text:`${d[ce]?.tl_tl_len??" "}`,tooltip:`${d[ce]?.tl_tl_len??" "}`,wrapping:false});ge.addCell($e);let ve=new sap.m.Text(`${"moc"+(ce+1)}`,{text:`${d[ce]?.moc??" "}`,tooltip:`${d[ce]?.moc??" "}`,wrapping:false});ge.addCell(ve);let _e=new sap.m.Text(`${"design_pressure_bar"+(ce+1)}`,{text:`${d[ce]?.design_pb??" "}`,tooltip:`${d[ce]?.design_pb??" "}`,wrapping:false});ge.addCell(_e);let be=new sap.m.Text(`${"weights_in_kg"+(ce+1)}`,{text:`${d[ce]?.weights??" "}`,tooltip:`${d[ce]?.weights??" "}`,wrapping:false});ge.addCell(be);let fe=new sap.m.Text(`${"qty_no"+(ce+1)}`,{text:`${d[ce]?.Quantity??" "}`,tooltip:`${d[ce]?.Quantity??" "}`,wrapping:false});ge.addCell(fe)}var x=c.getItems()[1].getContent()[0];x.destroyItems();if(n){var o={url:n+"odata/v4/catalogcbeservice/Vendor_details?$filter=ProjectId eq "+`'${s[1]}'`,method:"GET"}}else{var o={url:"/odata/v4/catalogcbeservice/Vendor_details?$filter=ProjectId eq "+`'${s[1]}'`,method:"GET"}}var u;await $.ajax(o).done(async(e,t,a)=>{u=e.value}).fail(e=>{console.log(e)});let de=new Set;let re=0;for(let Ce=0;Ce<u.length;Ce++){const Te=u[Ce].vendor_code;if(de.has(Te)){continue}de.add(Te);x.addItem(new sap.m.VBox(`${"sectionvbox"+(Ce+1)}`));let he=x.getItems()[re];re++;debugger;he.addStyleClass("BorderClass");he.addItem(new sap.m.VBox(`${"vboxsuppnameloc"+(Ce+1)}`));he.addItem(new sap.m.HBox(`${"hbmiddlesection"+(Ce+1)}`));he.addItem(new sap.m.VBox(`${"vbox_last_section"+(Ce+1)}`));var I=he.getItems()[2];I.setVisible(false);var w=new sap.m.ComboBox(`${"combobox"+(Ce+1)}`,{change:function(e){for(let t=0;t<e.getSource().getParent().getItems()[1].getItems().length;t++){if(e.getSource().getItems()[t].getText()==e.getSource().getValue()){e.getSource().getParent().getItems()[1].getItems()[t].setVisible(true)}else{e.getSource().getParent().getItems()[1].getItems()[t].setVisible(false)}}}});I.addItem(w);debugger;var v=new sap.m.HBox(`${"hboxcombo"+(Ce+1)}`);I.addItem(v);var _=I.getItems()[1];let ye=he.getItems()[0];ye.addItem(new sap.m.Title(`${"SupplierName"+(Ce+1)}`,{text:`${u[Ce].Vendor_Name?u[Ce].Vendor_Name:" "}`}));ye.addItem(new sap.m.Title(`${"SupplierLocation"+(Ce+1)}`,{text:`${u[Ce].Vendor_Location?u[Ce].Vendor_Location:" "}`}));debugger;ye.addStyleClass("v11spaceBetweenclass");var b=he.getItems()[1];debugger;let Pe=0;let Se=0;do{if(u[Pe].ProjectId==s[1]&&u[Pe].Proposed_Vendor_Code==u[Ce].Proposed_Vendor_Code){b.addItem(new sap.m.VBox(`${"vbmiddlesection"+se()}`,{}));var f=b.getItems().length;var C=b.getItems()[f-1];C.addStyleClass("customVBox");C.addItem(new sap.m.VBox(`${"vbmiddlesection_innervb"+se()}`));var T=C.getItems()[0];T.addItem(new sap.m.Text(`${"org_qtn_ref"+se()}`,{text:`${u[Pe]?.qtn_ref??" "}`}));T.addItem(new sap.m.Text(`${"org_date"+se()}`,{text:`${u[Pe]?.date??" "}`}));T.addItem(new sap.m.Text(`${"org_validity"+se()}`,{text:`${u[Pe]?.validity??" "}`}));T.addItem(new sap.m.Text(`${"org_cylindrical_space"+se()}`,{text:""}));T.addStyleClass("vbmiddlesectionclass");var h=new sap.m.VBox(`${"innervbox"+se()}`,{});C.addItem(h);debugger;let Be=m.find(e=>e.PAN_Number===u[Pe].PAN_Number);h.addItem(new sap.m.Label(`${"original_offer"+se()}`,{text:`${Be?.status_a??" "}`,design:"Bold"}));var y=new sap.m.Table({id:`${"offer"+se()}`,class:"tableBorder",growing:true,growingThreshold:20,width:"350px",fixedLayout:true});debugger;y.addStyleClass("tableBorder");h.addItem(y);var P=new sap.m.Column({id:`${"unit_rate"+se()}`,header:new sap.m.Label({text:"Unit Rate",design:"Bold",wrapping:false}),styleClass:"custcolorclass"});var S=new sap.m.Column({id:`${"unit_rate_per"+se()}`,header:new sap.m.Label({text:"Rate per Unit",design:"Bold",wrapping:false}),styleClass:"custcolorclass"});debugger;var V=new sap.m.Column({id:`${"total_amt_offer"+se()}`,header:new sap.m.HBox,styleClass:"custcolorclass"});y.addColumn(P);y.addColumn(S);y.addColumn(V);var B=y.getColumns()[2].getHeader();B.addItem(new sap.m.Label({text:"Total Amount",design:"Bold"}));var L=[];var N=0;var j="";let Le=0;let Ne=new Set;const je=d.filter(e=>e.PAN_Number===u[Pe].PAN_Number&&e.Proposed_Vendor_Code===u[Pe].Proposed_Vendor_Code);debugger;for(let Fe=0;Fe<le.length;Fe++){const Oe=le[Fe];const Qe=je.find(e=>e.Item_Code===Oe.Item_Code);if(Qe){var A=Qe.Amount.replace(/,/g,"")??0;var G=Qe.Quantity.replace(/,/g,"")??0;const We=Number(A??0)*Number(G??0);const ze=`${We} ${Qe.Unit_Price??" "}`;N+=We;j=Qe.Unit_Price;const Re=new sap.m.ColumnListItem({id:`${"item1data"+se()}`,cells:[new sap.m.Text({text:`${A??" "} ${Qe.Unit_Price}`}),new sap.m.Text({text:`${Qe.unit_rate_per_unit??" "}`}),new sap.m.Text({text:ze})]});y.addItem(Re)}else{const Je=new sap.m.ColumnListItem({id:`${"item1data"+se()}`,cells:[new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});y.addItem(Je)}}debugger;const Ae=i.filter(e=>e.PAN_Number===u[Pe].PAN_Number&&e.Proposed_Vendor_Code===u[Pe].Proposed_Vendor_Code);var E=new sap.m.ColumnListItem({id:`${"blankspace"+se()}`,cells:[new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});y.addItem(E);var q=new sap.m.ColumnListItem({id:`${"spare"+se()}`,cells:[new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:`${u[Pe]?.spares_for_2_years??" "}`})]});y.addItem(q);var k=new sap.m.ColumnListItem({id:`${"grandtotal"+se()}`,cells:[new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Label({text:`${N+" "+j}`,design:"Bold"})]});y.addItem(k);var D=new sap.m.ColumnListItem({id:`${"parkingmarking"+se()}`,visible:false,cells:[new sap.m.Text({text:`${u[Pe]?.packing_marking_forwarding??" "}`}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});y.addItem(D);var H=new sap.m.ColumnListItem({id:`${"inspection"+se()}`,visible:false,cells:[new sap.m.Text({text:`${u[Pe]?.inspection_testing_charges??" "}`}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});y.addItem(H);var M=new sap.m.ColumnListItem({id:`${"documentation"+se()}`,visible:false,cells:[new sap.m.Text({text:`${u[Pe]?.documentation_charges??" "}`}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});y.addItem(M);var U=new sap.m.ColumnListItem({id:`${"totalbasicpricing"+se()}`,cells:[new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Label({text:`${N+" "+j}`,design:"Bold"})]});y.addItem(U);var F=new sap.m.ColumnListItem({id:`${"rnod"+se()}`,cells:[new sap.m.Label({text:`${u[Pe]?.rnod??" "}`,design:"Bold"}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});y.addItem(F);var O=new sap.m.ColumnListItem({id:`${"customduty"+se()}`,visible:false,cells:[new sap.m.Text({text:`${u[Pe]?.custom_duty_cess??" "}`}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});y.addItem(O);var Q=new sap.m.ColumnListItem({id:`${"sgst"+se()}`,visible:false,cells:[new sap.m.Text({text:`${u[Pe]?.sgst??" "}`}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});y.addItem(Q);var W=new sap.m.ColumnListItem({id:`${"igst"+se()}`,visible:false,cells:[new sap.m.Text({text:`${u[Pe]?.igst??" "}`}),new sap.m.Text({text:""}),new sap.m.Text({text:`${Number(u[Pe]?.igst??" ")*Number(u[Pe]?.total_basic_price_including_packing??" ")/100}`})]});y.addItem(W);var z=new sap.m.ColumnListItem({id:`${"ugst"+se()}`,visible:false,cells:[new sap.m.Text({text:`${u[Pe]?.ugst??" "}`}),new sap.m.Text({text:""}),new sap.m.Text({text:`${Number(u[Pe]?.ugst??" ")*Number(u[Pe]?.total_basic_price_including_packing??" ")/100}`})]});y.addItem(z);var R=new sap.m.ColumnListItem({id:`${"shipment"+se()}`,visible:false,cells:[new sap.m.Text({text:`${u[Pe]?.shipment_charges??" "}`}),new sap.m.Text({text:""}),new sap.m.Text({text:""})]});y.addItem(R);var J=new sap.m.ColumnListItem({id:`${"totalincludingtaxes"+se()}`,cells:[new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Label({text:`${N+" "+j}`,design:"Bold"})]});y.addItem(J);var J=new sap.m.ColumnListItem({id:`${"total_excluding_taxes"+se()}`,cells:[new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Label({text:`${N+" "+j}`,design:"Bold"})]});y.addItem(J);var K=new sap.m.ColumnListItem({id:`${"perdiemrate"+se()}`,cells:[new sap.m.Text({text:""}),new sap.m.Text({text:""}),new sap.m.Text({text:`${u[Pe]?.per_diem_rate_for_supervision??" "}`})]});y.addItem(K);debugger;var X=I.getItems()[0];var Y=new sap.ui.core.Item(`${"item1"+se()}`,{text:`${Be?.status_a??" "}`});X.addItem(Y);X.setValue(`${Be?.status_a??""}`);_.addItem(new sap.m.VBox(`${"offer"+se()}`));var Z=_.getItems()[Se];Se++;debugger;Z.addStyleClass("spacebetweenclass");debugger;Z.addItem(new sap.m.Text(`${"pricebasis"+se()}`,{text:`${u[Pe]?.Vendor_Name??" "}`}));Z.getItems()[0].addStyleClass("pricebasispadding");Z.addItem(new sap.m.Text(`${"pointofdelivery"+se()}`,{text:`${u[Pe]?.Vendor_Name??" "}`}));Z.addItem(new sap.m.ScrollContainer(`${"deliveryperiodScroll"+se()}`,{vertical:true,height:"100px"}));Z.getItems()[1].addStyleClass("deliveryperiodpadding");Z.getItems()[2].addContent(new sap.m.Text(`${"deliveryperiod"+se()}`,{text:`${u[Pe]?.CPBG??" "}`}));Z.addItem(new sap.m.ScrollContainer(`${"paymenttermsScroll"+se()}`,{vertical:true,height:"100px"}));Z.getItems()[3].addContent(new sap.m.Text(`${"paymentterms"+se()}`,{text:`${u[Pe]?.CPBG??" "}`}));Z.addItem(new sap.m.ScrollContainer(`${"liquidedScroll"+se()}`,{vertical:true,height:"100px"}));Z.getItems()[4].addContent(new sap.m.Text(`${"liquided"+se()}`,{text:`${u[Pe]?.CPBG??" "}`}));Z.addItem(new sap.m.ScrollContainer(`${"warrantyScroll"+se()}`,{vertical:true,height:"100px"}));Z.getItems()[5].addContent(new sap.m.Text(`${"warranty"+se()}`,{text:`${u[Pe]?.CPBG??" "}`}));Z.addItem(new sap.m.ScrollContainer(`${"cpbgScroll"+se()}`,{vertical:true,height:"100px"}));Z.getItems()[6].addContent(new sap.m.Text(`${"cpbg"+se()}`,{text:`${u[Pe]?.CPBG??" "}`}));const Ge=Ae[0]?.Vendor_Contact_PersonDASH1??"";if(Ge){var ee=/name\s*:(.*?)\s*email/;var te=Ge.match(ee)}var ae=te?te[1].trim():null;debugger;Z.addItem(new sap.m.Text(`${"contactperson"+se()}`,{text:`${ae??"testContact"}`}));const Ee=/ph1\s*:\s*(.*?)\s*ph2/;const qe=Ge.match(Ee);const ke=qe?qe[1].trim():null;const De=/ph2\s*:\s*(.*?)$/;const He=Ge.match(De);const Me=He?He[1].trim():null;Z.addItem(new sap.m.Text(`${"contactno"+se()}`,{text:`${ke+", "+Me??"test"}`}));Z.addItem(new sap.m.Text(`${"ordercanbe"+se()}`,{text:`${u[Pe]?.order_given_to??"test"}`}));Z.addItem(new sap.m.Text(`${"technicallyapproved"+se()}`,{text:`${u[Pe]?.Technically_Approved??"test"}`}));Z.addItem(new sap.m.Text(`${"approvedvendor"+se()}`,{text:`${u[Pe]?.approved_vendor??"test"}`}));let Ue=Z.getItems()[Z.getItems().length-1];Ue.addStyleClass("customlaststyleclassrsection")}Pe++;debugger}while(Pe<u.length);debugger;for(let Ke=0;Ke<b.getItems().length-1;Ke++){debugger;b.getItems()[Ke].setVisible(false);b.getParent().getItems()[2].getItems()[1].getItems()[Ke].setVisible(false)}let Ve=b.getItems()[b.getItems().length-1];Ve.getItems()[1].getItems()[1].getColumns()[2].getHeader().addItem(new sap.ui.core.Icon(`${"total_amount_icon"+se()}`,{src:"sap-icon://expand",color:"darkblue",hoverColor:"red",activeColor:"darkgreen",size:"12px",width:"20px",press:function(e){debugger;var a=e.getSource().getParent().getParent().getParent().getParent().getParent().getParent().getItems();if(a.length==1){t.show("No More Status")}else{for(let t=0;t<a.length-1;t++){if(a[t].getVisible()==true){a[t].setVisible(false);e.getSource().setSrc("sap-icon://expand")}else{a[t].setVisible(true);e.getSource().setSrc("sap-icon://collapse")}}}}}));debugger}debugger;let me=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--rightHboxcontainer");sap.ui.core.BusyIndicator.hide()}catch(Xe){debugger;t.show(Xe)}}}}})});