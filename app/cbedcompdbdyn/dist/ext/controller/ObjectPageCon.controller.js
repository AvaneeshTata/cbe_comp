sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/m/MessageToast","sap/ui/export/Spreadsheet","sap/ui/model/json/JSONModel","sap/ui/export/library"],function(e,t,a){"use strict";var s=a.EdmType;let n=true;return e.extend("cbedcompdbdyn.ext.controller.ObjectPageCon",{override:{onInit:function(){var e=this.base.getExtensionAPI().getModel();let t=this.base.getView().mAggregations.content[0].mAggregations.headerTitle;t.destroyActions()},routing:{onAfterBinding:async function(e){try{function K(){var e=Math.floor(Math.random()*1e6);var t=(new Date).getTime();var a=t+"-"+e;return a}var a=e.sPath;var s=a.match(/'([^']+)'/);sap.ui.core.BusyIndicator.show();var n="";let Z="cbeObjectPageData";let ee=this.base.getView().getModel().bindContext(`/${Z}(...)`);ee.setParameter("projectId",s[1]);await ee.execute();let te=ee.getBoundContext().getValue();te=JSON.parse(te.value);var l=te[0][0];var o=te[1];var r=te[2];var i=te[3];var m=te[4];var d=te[5];var g=te[6];var p=this.getView().getContent()[0].getSections()[0].mAggregations._grid.getContent()[0].mAggregations._grid.getContent()[0].getContent();let ae=p.getItems()[0].getItems()[2].getItems()[0].getColumns();for(let pe=0;pe<ae.length;pe++){ae[pe].setStyleClass("custcolorclass")}p.getItems()[0].getItems()[0].getItems()[0].getItems()[0].getItems()[0].setVisible(false);p.getItems()[0].getItems()[0].getItems()[0].getItems()[1].getItems()[1].setText(`${" "+l[0]?.Project_Description??" "}`);p.getItems()[0].getItems()[0].getItems()[0].getItems()[1].getItems()[1].setTextAlign("End");p.getItems()[0].getItems()[0].getItems()[0].getItems()[2].getItems()[0].setVisible(false);var c=p.getItems()[0].getItems()[2].getItems()[0];var I=p.getItems()[0].getItems()[1].getItems()[0];if(!I.getItems()[1]){I.addItem(new sap.ui.core.Icon(`${"cylindricaldtaicon"+K()}`,{src:"sap-icon://expand",color:"darkblue",hoverColor:"red",activeColor:"darkgreen",size:"12px",width:"20px",press:function(e){var t=p.getItems()[0];let a=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--total_basic_pricing");let s;let n=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::CustomSubSection::Fragment--newItemID1");let l;if(t.getWidth()=="30%"){c.setFixedLayout(false);t.setWidth("80%");e.getSource().setSrc("sap-icon://collapse")}else{c.setFixedLayout(true);t.setWidth("30%");e.getSource().setSrc("sap-icon://expand")}debugger;let o=0;let r=c.getColumns();for(let e=0;e<r.length;e++){if(r[e].getVisible()==true){o++}}if(o<5){c.setFixedLayout(true)}}}))}c.destroyItems();const se=new Set;const ne=[];o.forEach(e=>{if(!se.has(e.Item_Code)){se.add(e.Item_Code);ne.push(e)}});let le=1;for(let ce=0;ce<ne.length;ce++){c.addItem(new sap.m.ColumnListItem(`${"collistitem"+(ce+1)}`));let Ie=c.getItems()[ce];let ue=new sap.m.Text(`${"itemdesc"+(ce+1)}`,{text:`${o[ce]?.Item_Short_Description??" "}`,tooltip:`${o[ce]?.Item_Short_Description??" "}`,wrapping:false});Ie.addCell(ue);let xe=new sap.m.Text(`${"tag_no"+(ce+1)}`,{text:`${o[ce]?.tag_no??" "}`,tooltip:`${o[ce]?.tag_no??" "}`,wrapping:false});Ie.addCell(xe);let we=new sap.m.Text(`${"types_of_vessel"+(ce+1)}`,{text:`${o[ce]?.types_of_vessel??" "}`,tooltip:`${o[ce]?.types_of_vessel??" "}`,wrapping:false});Ie.addCell(we);let Ce=new sap.m.Text(`${"capacity_each_in_cu_mtr"+(ce+1)}`,{text:`${o[ce]?.capactity_each??" "}`,tooltip:`${o[ce]?.capactity_each??" "}`,wrapping:false});Ie.addCell(Ce);let $e=new sap.m.Text(`${"dia_in_mm"+(ce+1)}`,{text:`${o[ce]?.dia??" "}`,tooltip:`${o[ce]?.dia??" "}`,wrapping:false});Ie.addCell($e);let _e=new sap.m.Text(`${"tl_to_tl_len"+(ce+1)}`,{text:`${o[ce]?.tl_tl_len??" "}`,tooltip:`${o[ce]?.tl_tl_len??" "}`,wrapping:false});Ie.addCell(_e);let fe=new sap.m.Text(`${"moc"+(ce+1)}`,{text:`${o[ce]?.moc??" "}`,tooltip:`${o[ce]?.moc??" "}`,wrapping:false});Ie.addCell(fe);let ve=new sap.m.Text(`${"design_pressure_bar"+(ce+1)}`,{text:`${o[ce]?.design_pb??" "}`,tooltip:`${o[ce]?.design_pb??" "}`,wrapping:false});Ie.addCell(ve);let be=new sap.m.Text(`${"weights_in_kg"+(ce+1)}`,{text:`${o[ce]?.weights??" "}`,tooltip:`${o[ce]?.weights??" "}`,wrapping:false});Ie.addCell(be);let he=new sap.m.Text(`${"uom"+(ce+1)}`,{text:`${o[ce]?.UOM??" "}`,tooltip:`${o[ce]?.UOM??" "}`,wrapping:false});Ie.addCell(he);let Se=new sap.m.Text(`${"qty_no"+(ce+1)}`,{text:`${o[ce]?.Quantity??" "}`,tooltip:`${o[ce]?.Quantity??" "}`,wrapping:false});Ie.addCell(Se)}let oe={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0};for(let ye=0;ye<c.getColumns().length;ye++){c.getColumns()[ye].setVisible(true)}for(let Te=0;Te<c.getItems().length;Te++){let Pe=c.getItems()[Te].getCells();for(let Ve=0;Ve<Pe.length;Ve++){if(Pe[Ve].getText().trim()==""){oe[Ve]+=1}}}for(let Ne in oe){if(oe[Ne]==c.getItems().length){c.getColumns()[Ne].setVisible(false)}}var u=p.getItems()[1].getContent()[0];u.destroyItems();let re=new Set;let ie=0;for(let Le=0;Le<r.length;Le++){const Ae=r[Le].vendor_code;if(re.has(Ae)){continue}re.add(Ae);u.addItem(new sap.m.VBox(`${"sectionvbox"+(Le+1)}`));let Be=u.getItems()[ie];ie++;Be.addStyleClass("BorderClass");Be.addItem(new sap.m.VBox(`${"vboxsuppnameloc"+(Le+1)}`));Be.addItem(new sap.m.HBox(`${"hbmiddlesection"+(Le+1)}`));Be.addItem(new sap.m.VBox(`${"vbox_last_section"+(Le+1)}`));Be.getItems()[0].addStyleClass("stickyright");var x=Be.getItems()[2];var w=new sap.m.ComboBox(`${"combobox"+(Le+1)}`,{change:function(e){for(let t=0;t<e.getSource().getParent().getItems()[1].getItems().length;t++){if(e.getSource().getItems()[t].getText()==e.getSource().getValue()){e.getSource().getParent().getItems()[1].getItems()[t].setVisible(true)}else{e.getSource().getParent().getItems()[1].getItems()[t].setVisible(false)}}}});x.addItem(w);var C=new sap.m.HBox(`${"hboxcombo"+(Le+1)}`);x.addItem(C);var $=x.getItems()[1];let De=Be.getItems()[0];De.addStyleClass("alignmentVendorClass");De.addItem(new sap.m.Title(`${"SupplierName"+(Le+1)}`,{text:`${r[Le].Vendor_Name?r[Le].Vendor_Name:" "}`}));De.getItems()[0].addStyleClass("titleStyleClass");De.addItem(new sap.m.Title(`${"SupplierLocation"+(Le+1)}`,{text:`${r[Le].Vendor_Location?r[Le].Vendor_Location:" "}`}));De.getItems()[1].addStyleClass("titleStyleClass");De.addStyleClass("v11spaceBetweenclass");var _=Be.getItems()[1];_.addStyleClass("alignmentVendorClass");let Fe=0;let Oe=0;do{if(r[Fe].ProjectId==s[1]&&r[Fe].Proposed_Vendor_Code==r[Le].Proposed_Vendor_Code){let je=r[Fe].PAN_Number;function Me(e){for(let t=0;t<g.length;t++){if(g[t].number===e){return true}}return false}if(Me(je)){let He=g.filter(e=>e.number===r[Fe].PAN_Number);for(let Ee=0;Ee<He.length;Ee++){_.addItem(new sap.m.VBox(`${"vbmiddlesection"+K()}`,{}));var f=_.getItems().length;var v=_.getItems()[f-1];v.addStyleClass("customVBox");v.addItem(new sap.m.VBox(`${"vbmiddlesection_innervb"+K()}`));var b=v.getItems()[0];b.addItem(new sap.m.Text(`${"org_qtn_ref"+K()}`,{text:`${He[Ee]?.number??"NA"}`}));b.addItem(new sap.m.Text(`${"org_date"+K()}`,{text:`${He[Ee]?.date??"NA"}`}));b.addItem(new sap.m.Text(`${"org_validity"+K()}`,{text:`${r[Fe]?.validity??"NA"}`}));b.addItem(new sap.m.Text(`${"org_cylindrical_space"+K()}`,{text:""}));b.addStyleClass("vbmiddlesectionclass");var h=new sap.m.VBox(`${"innervbox"+K()}`,{alignItems:"Center"});v.addItem(h);let Re=i.find(e=>e.PAN_Number===r[Fe].PAN_Number);h.addItem(new sap.m.Label(`${"original_offer"+K()}`,{text:`${He[Ee]?.eventNo??" "}`,design:"Bold"}));var S=new sap.m.Table({id:`${"offer"+K()}`,class:"tableBorder",growing:true,growingThreshold:20,width:"350px",fixedLayout:true});S.addStyleClass("tableBorder");h.addItem(S);var y=new sap.m.Column({id:`${"unit_rate"+K()}`,header:new sap.m.Label({text:"Unit Rate",design:"Bold",wrapping:false})});var T=new sap.m.Column({id:`${"total_amt_offer"+K()}`,header:new sap.m.HBox});S.addColumn(y);S.addColumn(T);var P=S.getColumns()[1].getHeader();P.addItem(new sap.m.Label({text:"Total Amount",design:"Bold"}));var V=[];var N=0;var L="";let Ue=0;let qe=new Set;const We=o.filter(e=>e.PAN_Number===r[Fe].PAN_Number&&e.Proposed_Vendor_Code===r[Fe].Proposed_Vendor_Code);let Ge=0;let Qe="";function ze(e,t){let a="";switch(t){case"INR":a+=parseFloat(e).toLocaleString("en-IN",{maximumFractionDigits:2});break;default:a+=parseFloat(e).toLocaleString("en-US",{maximumFractionDigits:2});break}return a}const Je=m.filter(e=>e.PAN_Number===r[Fe].PAN_Number&&e.Proposed_Vendor_Code===r[Fe].Proposed_Vendor_Code);L=Je[0]?.Order_CurrencyORBid_currency??"NA";for(let ct=0;ct<ne.length;ct++){const It=ne[ct];let ut=o.filter(e=>e.ProjectId==s[1]&&e.Proposed_Vendor_Code==r[Fe].Proposed_Vendor_Code&&e.Item_Code==ne[ct].Item_Code&&e.PAN_Number==je);const xt=We.find(e=>e.Item_Code===It.Item_Code);if(xt||ut.length){var A=ut[0].Amount?.replace(/,/g,"")??0;var B=ut[0].Quantity?.replace(/,/g,"")??0;let wt=ut[0].extendedPrice?.replace(/,/g,"")??0;Ge=Ge+parseFloat(wt??0);Qe=Qe+(ut[0]?.Indian_Tax_PER??" ")+"\n";const Ct=Number(A??0)*Number(B??0);const $t=`${Ct} ${ut[0].Unit_Price??" "}`;N+=Ct;const _t=new sap.m.ColumnListItem({id:`${"item1data"+K()}`,cells:[new sap.m.Text({text:`${ze(A,L)??" "} ${L}`}),new sap.m.Text({text:`${ze(Ct,L)+" "+L}`})]});S.addItem(_t)}else{const ft=new sap.m.ColumnListItem({id:`${"item1data"+K()}`,cells:[new sap.m.Text({text:""}),new sap.m.Text({text:""})]});S.addItem(ft)}}const Xe=d.filter(e=>e.PAN_Number===r[Fe].PAN_Number&&e.Proposed_Vendor_Code===r[Fe].Proposed_Vendor_Code);let Ye={};const Ke=["Spares for 2 Years operation","Packing, Marking, Forwarding & Freight","Inspection / Testing Charges","Documentation Charges","RNOD","Custom Duty & Cess","SGST","IGST","UGST","Shipment charges from EXW to ISRO Mahendragiri","Per Diem rate for Supervision for Erection and commissioning","PriceBasis","Point of Delivery","Delivery Period","Payment Terms","Liquidated Damages","Warranty / Defect Liability Period","CPBG","Contact Person","Contact No.","Order can be given to","Techncially Approved","Approved Vendor","Freight","Inspection Value","Document Value"];for(let vt=0;vt<Xe.length;vt++){const bt=Xe[vt];if(Ke.includes(bt.name)){Ye[bt.name]=bt.value}}var D=new sap.m.ColumnListItem({id:`${"blankspace"+K()}`,cells:[new sap.m.Text({text:""}),new sap.m.Text({text:""})]});S.addItem(D);var F=new sap.m.ColumnListItem({id:`${"spare"+K()}`,cells:[new sap.m.Text({text:""}),new sap.m.Text({text:`${ze(Ye[Ke[0]]??0)+" "+L??" "}`})]});let Ze=N+(parseFloat(Ye[Ke[0]])||0);S.addItem(F);var O=new sap.m.ColumnListItem({id:`${"grandtotal"+K()}`,cells:[new sap.m.Text({text:""}),new sap.m.Label({text:`${ze(Ze)+" "+L}`,design:"Bold"})]});S.addItem(O);var k=new sap.m.ColumnListItem({id:`${"parkingmarking"+K()}`,visible:false,cells:[new sap.m.Text({text:`${Ye[Ke[1]]??" "}`}),new sap.m.Text({text:`${ze(Ye[Ke[23]]??0)+" "+L}`})]});S.addItem(k);var j=new sap.m.ColumnListItem({id:`${"inspection"+K()}`,visible:false,cells:[new sap.m.Text({text:`${Ye[Ke[2]]??" "}`}),new sap.m.Text({text:`${Ye[Ke[24]]??" "}`})]});S.addItem(j);var M=new sap.m.ColumnListItem({id:`${"documentation"+K()}`,visible:false,cells:[new sap.m.Text({text:`${Ye[Ke[3]]??" "}`}),new sap.m.Text({text:`${Ye[Ke[25]]??" "}`})]});let et=Ze+(parseInt(Ye[Ke[23]])||0)+(parseInt(Ye[Ke[24]])||0)+(parseInt(Ye[Ke[25]])||0);S.addItem(M);var H=new sap.m.ColumnListItem({id:`${"rnod"+K()}`,visible:false,cells:[new sap.m.Label({text:`${Ye[Ke[4]]??" "}`,design:"Bold"}),new sap.m.Text({text:""})]});S.addItem(H);var E=new sap.m.ColumnListItem({id:`${"customduty"+K()}`,visible:false,cells:[new sap.m.Text({text:`${Ye[Ke[5]]??" "}`}),new sap.m.Text({text:""})]});S.addItem(E);var R=new sap.m.CustomListItem({id:`${"tax_field"+K()}`,visible:false,content:[new sap.m.Text({text:Qe,width:"294px"})]});S.addItem(R);let tt=(parseFloat(Ye[Ke[6]])||0)*et/100;let at=(parseFloat(Ye[Ke[7]])||0)*et/100;let st=(parseFloat(Ye[Ke[8]])||0)*et/100;var U=new sap.m.ColumnListItem({id:`${"shipment"+K()}`,visible:false,cells:[new sap.m.Text({text:`${Ye[Ke[9]]??" "}`}),new sap.m.Text({text:""})]});if(!Ge){Ge=0}let nt=et+tt+at+st;S.addItem(U);var q=new sap.m.ColumnListItem({id:`${"totalincludingtaxes"+K()}`,cells:[new sap.m.Text({text:""}),new sap.m.Label({text:`${ze(Ge??0)+" "+L}`,design:"Bold"})]});S.addItem(q);var q=new sap.m.ColumnListItem({id:`${"total_excluding_taxes"+K()}`,cells:[new sap.m.Text({text:""}),new sap.m.Label({text:`${ze(Ge)+" "+L}`,design:"Bold"})]});S.addItem(q);var W=new sap.m.ColumnListItem({id:`${"perdiemrate"+K()}`,cells:[new sap.m.Text({text:`${Ye[Ke[10]]??" "}`}),new sap.m.Text({text:""})]});S.addItem(W);if(r[Fe].Rank=="1"){S.getColumns()[0].setStyleClass("columnStyleClass");S.getColumns()[1].setStyleClass("columnStyleClass");S.getItems()[S.getItems().length-5].addStyleClass("columnStyleClass")}S.getItems()[S.getItems().length-5].addStyleClass("taxCell");var G=x.getItems()[0];var Q=new sap.ui.core.Item(`${"item1"+K()}`,{text:`${He[Ee].eventNo??" "}`});G.addItem(Q);G.setValue(`${He[Ee].eventNo??""}`);$.addItem(new sap.m.VBox(`${"offer"+K()}`));var z=$.getItems()[Oe];Oe++;z.addStyleClass("spacebetweenclass");z.addItem(new sap.m.ScrollContainer(`${"deliveryperiodScroll"+K()}`,{vertical:true,width:"350px",height:"100px"}));z.getItems()[0].addContent(new sap.m.Text(`${"Scopedeliveryperiod"+K()}`,{text:`${Je[0]?.Scope_and_Responsibilities??" "}`}));z.addItem(new sap.m.ScrollContainer(`${"CommercialpaymenttermsScroll"+K()}`,{vertical:true,height:"100px"}));z.getItems()[1].addContent(new sap.m.Text(`${"Compliancepaymentterms"+K()}`,{text:`${Je[0]?.Commercial_Terms??" "}`}));z.addItem(new sap.m.ScrollContainer(`${"OthersliquidedScroll"+K()}`,{vertical:true,height:"100px"}));z.getItems()[2].addContent(new sap.m.Text(`${"Othersliquided"+K()}`,{text:`${Je[0]?.Compliance_Terms??" "}`}));z.addItem(new sap.m.ScrollContainer(`${"warrantyScroll"+K()}`,{vertical:true,height:"100px"}));z.getItems()[3].addContent(new sap.m.Text(`${"warranty"+K()}`,{text:`${Je[0]?.Others??" "}`}));const lt=Je[0]?.Vendor_Contact_PersonDASH1??"";if(lt){var J=/name\s*:(.*?)\s*email/;var X=lt.match(J)}var Y=X?X[1].trim():null;z.addItem(new sap.m.Text(`${"contactperson"+K()}`,{text:`${Je[0]?.Vendor_Contact_PersonDASH1??" "}`}));const ot=/ph1\s*:\s*(.*?)\s*ph2/;const rt=lt.match(ot);let it=rt?rt[1].trim():null;const mt=/ph2\s*:\s*(.*?)$/;const dt=lt.match(mt);let gt=dt?dt[1].trim():null;if(it==null){it=" "}if(gt==null){gt=" "}z.addItem(new sap.m.Text(`${"contactno"+K()}`,{text:`${it+" "+gt??" "}`}));z.addItem(new sap.m.Text(`${"ordercanbe"+K()}`,{text:`${Ye["Order can be give to"]??" "}`}));z.addItem(new sap.m.Text(`${"technicallyapproved"+K()}`,{text:`${r[Fe].Technically_Approved??" "}`}));z.addItem(new sap.m.Text(`${"approvedvendor"+K()}`,{text:`${r[Fe].Awarded_Vendor??" "}`}));let pt=z.getItems()[z.getItems().length-1];pt.addStyleClass("customlaststyleclassrsection")}}}Fe++}while(Fe<r.length);for(let ht=0;ht<_.getItems().length-1;ht++){_.getItems()[ht].setVisible(false);_.getParent().getItems()[2].getItems()[1].getItems()[ht].setVisible(false)}let ke=_?.getItems()[_?.getItems().length-1];if(ke){ke.getItems()[1].getItems()[1].getColumns()[1].getHeader().addItem(new sap.ui.core.Icon(`${"total_amount_icon"+K()}`,{src:"sap-icon://expand",color:"darkblue",hoverColor:"red",activeColor:"darkgreen",size:"12px",width:"20px",press:function(e){var a=e.getSource().getParent().getParent().getParent().getParent().getParent().getParent().getItems();if(a.length==1){t.show("No More Status")}else{for(let t=0;t<a.length-1;t++){if(a[t].getVisible()==true){a[t].setVisible(false);e.getSource().setSrc("sap-icon://expand")}else{a[t].setVisible(true);e.getSource().setSrc("sap-icon://collapse")}}}}}))}}sap.ui.core.BusyIndicator.hide();let me=p.getItems()[0].getItems()[3].getItems();for(let St=2;St<=8;St++){me[St].setVisible(false)}for(let yt=13;yt<me.length;yt++){me[yt].setVisible(false)}if(me[9].getItems()[1].getSrc()=="sap-icon://navigation-up-arrow"){me[9].getItems()[1].setSrc("sap-icon://navigation-right-arrow")}if(me[12].getItems()[1].getSrc()=="sap-icon://navigation-down-arrow"){me[12].getItems()[1].setSrc("sap-icon://navigation-right-arrow")}debugger;let de=sap.ui.getCore().byId("cbedcompdbdyn::Project_DetailsObjectPage--fe::HeaderFacetCustomContainer::HeaderFragment--rowexpand");debugger;let ge=p.getItems()[1].getContent()[0].getItems();for(let Tt=0;Tt<ge.length;Tt++){ge[Tt].getItems()[2].setVisible(false)}}catch(Pt){t.show(Pt)}}}}})});